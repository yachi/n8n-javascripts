// Simple test for main.js
// This creates a standalone version for testing the n8n script

// Helper function to format dates consistently (copied from main.js)
function formatDate(dateStr) {
  // Convert to string if it's a number
  const str = String(dateStr);
 
  // Handle ISO format (YYYY-MM-DDTHH:MM:SS) or compact format (YYYYMMDD)
  if (str.includes('T')) {
    return str.split('T')[0];
  }
 
  // Convert YYYYMMDD to YYYY-MM-DD
  return `${str.slice(0,4)}-${str.slice(4,6)}-${str.slice(6,8)}`;
}

// Test formatDate function for the n8n error fix
function testDateFormatting() {
  console.log('ğŸ§ª Testing formatDate function (n8n error fix)');
  console.log('â”'.repeat(40));
 
  const testCases = [
    { input: 20241209, expected: '2024-12-09', desc: 'Numeric (n8n TARGETDATE)' },
    { input: '20241209', expected: '2024-12-09', desc: 'String YYYYMMDD' },
    { input: '2024-12-09T10:30:00', expected: '2024-12-09', desc: 'ISO with time' },
  ];
 
  let allPassed = true;
  testCases.forEach(test => {
    const result = formatDate(test.input);
    const passed = result === test.expected;
    console.log(`${passed ? 'âœ…' : 'âŒ'} ${test.desc}: ${test.input} â†’ ${result}`);
    if (!passed) allPassed = false;
  });
 
  console.log('â”'.repeat(40));
  console.log(allPassed ? 'âœ… All date tests passed!\n' : 'âŒ Some date tests failed!\n');
  return allPassed;
}

(async function() {
  // Run date formatting tests first
  testDateFormatting();
 
  console.log('ğŸ“º Demo: main.js output format');
  console.log('ğŸ˜Š Clean and simple UK Green Energy Outlook');
  console.log('âœ… Using facial expressions for ratings');
  console.log('');

  // Show sample output format
  console.log('ğŸ”„ Sample output format:\n');
 
  const sampleMessage = `ğŸŒ± **UK Green Energy Outlook**

ğŸ“Š Yesterday: **67% green energy** ğŸ˜Š

ğŸ“ˆ This week: **61% renewable** ğŸ˜Š

**Mon** ğŸ˜ 85% â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘
**Tue** ğŸ˜Š 72% â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘
**Wed** ğŸ˜Š 68% â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘
**Thu** ğŸ˜ 45% â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘
**Fri** ğŸ˜• 32% â–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘
**Sat** ğŸ˜Š 64% â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘
**Sun** ğŸ˜Š 71% â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘

ğŸ† Best: Mon (85%)
âš¡ Lowest: Fri (32%)

ğŸ’­ Good renewable energy week expected.`;

  console.log(sampleMessage);
  console.log('\nâœ… This is the format generated by main.js in n8n');
})();